import tkinter as tk
from tkinter import messagebox
import csv
import datetime
import matplotlib.pyplot as plt
import os

FILE_NAME = "bmi_records.csv"

# Create file if not exists
if not os.path.exists(FILE_NAME):
    with open(FILE_NAME, "w", newline="") as file:
        writer = csv.writer(file)
        writer.writerow(["Date", "BMI"])

def calculate_bmi():
    try:
        weight = float(weight_entry.get())
        height = float(height_entry.get())

        if weight <= 0 or height <= 0:
            messagebox.showerror("Invalid Input", "Values must be positive.")
            return

        bmi = weight / (height ** 2)

        if bmi < 18.5:
            category = "Underweight"
        elif bmi < 25:
            category = "Normal"
        elif bmi < 30:
            category = "Overweight"
        else:
            category = "Obese"

        result_label.config(text=f"BMI: {bmi:.2f}\nCategory: {category}")

        save_data(bmi)

    except ValueError:
        messagebox.showerror("Invalid Input", "Enter valid numbers only.")

def save_data(bmi):
    today = datetime.date.today().strftime("%d-%m-%Y")
    with open(FILE_NAME, "a", newline="") as file:
        writer = csv.writer(file)
        writer.writerow([today, bmi])

def show_graph():
    dates = []
    bmi_values = []

    try:
        with open(FILE_NAME, "r") as file:
            reader = csv.reader(file)
            next(reader)
            for row in reader:
                dates.append(row[0])
                bmi_values.append(float(row[1]))

        if not bmi_values:
            messagebox.showinfo("No Data", "No BMI data available.")
            return

        plt.figure()
        plt.plot(dates, bmi_values, marker='o')
        plt.xlabel("Date")
        plt.ylabel("BMI")
        plt.title("BMI Trend Analysis")
        plt.xticks(rotation=45)
        plt.tight_layout()
        plt.show()

    except Exception as e:
        messagebox.showerror("Error", str(e))

# GUI Setup
root = tk.Tk()
root.title("BMI Calculator")
root.geometry("350x320")

tk.Label(root, text="BMI Calculator", font=("Arial", 16, "bold")).pack(pady=10)

tk.Label(root, text="Weight (kg)").pack()
weight_entry = tk.Entry(root)
weight_entry.pack()

tk.Label(root, text="Height (meters)").pack()
height_entry = tk.Entry(root)
height_entry.pack()

tk.Button(root, text="Calculate BMI", command=calculate_bmi).pack(pady=10)
tk.Button(root, text="View BMI Graph", command=show_graph).pack()

result_label = tk.Label(root, text="", font=("Arial", 12))
result_label.pack(pady=10)

root.mainloop()
